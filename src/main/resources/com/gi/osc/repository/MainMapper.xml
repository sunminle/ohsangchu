<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    <mapper namespace="com.gi.osc.repository.MainMapper">
    	
    	<!--
    	<select id="searchList" parameterType="com.gi.osc.bean.StoreDTO" resultType="com.gi.osc.bean.StoreDTO">
    		 select * from dbo.store where delete_yn='N' 
    		 <choose>
    		 	<when test="type !=null and type.equals('storename')">
    		 	and storename like CONCAT('%', #{keyword}, '%')
    		 	</when>
    		 </choose>
    	</select>
    	-->
    	<!--  상품검색 -->
    	<select id="searchProductsByName" parameterType="String" resultType="com.gi.osc.bean.ProductDTO">
		    SELECT a.*, p.*
		    FROM posting a
		    JOIN product p ON a.id = p.postingid(+)  
    		<where>
        		<if test="searchKeyword != null and searchKeyword != ''">
		            AND (p.productname LIKE '%' || #{searchKeyword, jdbcType=VARCHAR} || '%'
		            OR a.title LIKE '%' || #{searchKeyword, jdbcType=VARCHAR} || '%'
		            OR a.content LIKE '%' || #{searchKeyword, jdbcType=VARCHAR} || '%')
		        </if>
   			</where>
		</select>
		
		
	<!-- 상점 검색 -->
		<select id="searchStoreByName" parameterType="String" resultType="com.gi.osc.bean.StoreDTO">
   			select s.*, u.* 
			from users u
			join store s on u.id = s.userId(+)
			<where>
				<if test="searchKeyword != null and searchKeyword != ''">
 					AND (s.storeName LIKE '%' || #{searchKeyword, jdbcType=VARCHAR} || '%'
       				OR u.nickname LIKE '%' || #{searchKeyword, jdbcType=VARCHAR} || '%')
        		</if>
        	</where>
		</select>
	 	
	 	<!-- 판매량이 높은 제품 조회 -->
		<select id="countPopularProducts" resultType="com.gi.osc.bean.PaymentDTO">
    <![CDATA[
    SELECT * FROM (
        SELECT po.id, COUNT(*) as totalCount, po.title, po.thumnail
        FROM payment pm
        JOIN posting po ON pm.postingId = po.id
        GROUP BY po.id, po.title, po.thumnail
        ORDER BY totalCount DESC
    )
    WHERE ROWNUM <= 6
    ]]>
</select>











    </mapper>